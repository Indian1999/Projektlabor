@startuml Genetic Algorithm Sequence
!theme plain
skinparam backgroundColor #FEFEFE
skinparam sequenceActorBackgroundColor #E3F2FD
skinparam sequenceActorBorderColor #333333
skinparam sequenceParticipantBackgroundColor #F3E5F5
skinparam sequenceParticipantBorderColor #333333
skinparam arrowColor #333333

' ==================== Participants ====================

actor "Felhasználó" as User
participant "ServerApplication" as ServerApp
participant "Process" as Process
participant "Genetic" as Genetic
participant "Space" as Space
participant "Cube" as Cube

' ==================== Sequence ====================

User ->> ServerApp: add_process(genetic_solver)
activate ServerApp
    ServerApp ->> Process: __init__(solver, priority)
    activate Process
        Process --> ServerApp: Process létrehozva
    deactivate Process
    ServerApp ->> Process: run_solver() (szálon)
    activate Process
        Process ->> Genetic: run()
        activate Genetic
            loop minden generáció (0...N)
                Genetic ->> Genetic: selection()
                activate Genetic
                    note over Genetic: k legjobb egyed kiválasztása
                deactivate Genetic

                loop minden populáció pár
                    Genetic ->> Genetic: crossover(parent1, parent2)
                    activate Genetic
                        Genetic ->> Space: új Space létrehozása
                        activate Space
                            Space ->> Cube: cubók beállítása
                            activate Cube
                                Cube --> Space: Cube instancek
                            deactivate Cube
                            Space --> Genetic: új Space (offspring)
                        deactivate Space
                    deactivate Genetic

                    alt mutáció (mutation_rate)
                        Genetic ->> Genetic: mutation(individual)
                        activate Genetic
                            Genetic ->> Space: véletlenszerű módosítás
                            Space --> Genetic: mutált Space
                        deactivate Genetic
                    end
                end

                loop minden egyed
                    Genetic ->> Genetic: fitness(individual)
                    activate Genetic
                        Genetic ->> Space: evaluate()
                        activate Space
                            Space ->> Space: monte_carlo_filled_ratio()
                            Space --> Genetic: fitness érték
                        deactivate Space
                    deactivate Genetic
                end

                Genetic ->> Genetic: populáció szelekciója
                note over Genetic: legjobb egyedek megtartása
            end

            Genetic --> Process: legjobb megoldás (best Space)
        deactivate Genetic
        Process --> ServerApp: futás befejezve
    deactivate Process
deactivate ServerApp

User ->> ServerApp: get_best_space(n)
activate ServerApp
    ServerApp --> User: legjobb n Space (eredmények)
deactivate ServerApp

@enduml
